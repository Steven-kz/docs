import{_ as e,M as o,p as c,q as l,R as n,t as s,N as p,a1 as a}from"./framework-5866ffd3.js";const i={},u=a(`<h1 id="elasticsearch" tabindex="-1"><a class="header-anchor" href="#elasticsearch" aria-hidden="true">#</a> ElasticSearch</h1><h2 id="海量数据下如何快速搜索" tabindex="-1"><a class="header-anchor" href="#海量数据下如何快速搜索" aria-hidden="true">#</a> 海量数据下如何快速搜索</h2><p>绝对不使⽤模糊查询，因为性能太低。 解决海量数据的快速搜索，就需要使⽤全⽂检索技术，选择ElasticSearch 市⾯上有全⽂检索技术：Lucene、Solr(底层：Lucene)、ElasticSearch（底层：Lucene） ⽬前市⾯上：ElasticSearch ELK：ElasticSearch（存储、搜索）+Logstash（采集）+Kibana（可视化） ⽇志平台 数据存储技术： 1.数据库 关系型数据库 存储最完整的数据 主流：Mysql、Oracle、PostgreSQL、分布式数据库(TiDB) 2.Redis 主要存储热点数据，数据存储在内存中 主流：Redis （数据类型） 3.ElasticSearch <strong>主要存储的查询的数据，⽀持海量数据存储和查询，⼀定要带条件</strong> 主流：ElasticSearch 4.资源存储 主要存储资源，图⽚、视频、⾳频等，存储在对象存储 主流：阿⾥云-OSS(公⽹)、Minio(内⽹)</p><h1 id="一、elasticsearch是什么" tabindex="-1"><a class="header-anchor" href="#一、elasticsearch是什么" aria-hidden="true">#</a> 一、ElasticSearch是什么</h1><p>分布式搜索和分析引擎，主要实现近乎实时的搜索和分析。可以实现海量数据的存储（⽀持PB级别的数 据），可以实现快速搜索（倒排索引）还可以实现数据分析处理.</p><h2 id="_1-1elasticsearch的特性" tabindex="-1"><a class="header-anchor" href="#_1-1elasticsearch的特性" aria-hidden="true">#</a> 1.1Elasticsearch的特性</h2><p>ElasticSearch是基于Lucene开发的分布式搜索框架，包含如下特性：</p><ol><li>分布式索引、搜索。</li><li>索引自动分片、负载均衡。</li><li>自动发现机器、组建集群。</li><li>支持Restful 风格接口。</li><li>配置简单等。</li><li>海量数据的存储。</li></ol><h1 id="二、docker安装es" tabindex="-1"><a class="header-anchor" href="#二、docker安装es" aria-hidden="true">#</a> 二、Docker安装ES</h1><h2 id="_2-1-基于docker安装elasticsearch" tabindex="-1"><a class="header-anchor" href="#_2-1-基于docker安装elasticsearch" aria-hidden="true">#</a> 2.1 基于Docker安装Elasticsearch</h2><p>1.创建并运行容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> es9200 <span class="token parameter variable">-e</span> <span class="token string">&quot;discovery.type=single-node&quot;</span> <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 elasticsearch:7.12.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,12),r={href:"http://xn--83t364h:9200/",target:"_blank",rel:"noopener noreferrer"},k=a(`<h2 id="_2-2安装kibana-对es进行可视化操作" tabindex="-1"><a class="header-anchor" href="#_2-2安装kibana-对es进行可视化操作" aria-hidden="true">#</a> 2.2安装Kibana：对es进⾏可视化操作</h2><p>1.执⾏命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> kibana5601 <span class="token parameter variable">-p</span> <span class="token number">5601</span>:5601 kibana:7.1.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2.修改es 查看es容器的地址</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> inspect es9200
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>进⼊到Kibana内部，修改es地址 <strong>IPAddress</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> kibana5601 <span class="token function">bash</span>

<span class="token function">vi</span> config/kibana.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>刷新配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart kibana5601
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,9),d={href:"http://110.40.192.129:5601/app/kibana",target:"_blank",rel:"noopener noreferrer"},m=a(`<h1 id="三、elasticsearch核心" tabindex="-1"><a class="header-anchor" href="#三、elasticsearch核心" aria-hidden="true">#</a> 三、ElasticSearch核⼼</h1><p>Java程序员操作ES有2种⽅式：</p><h2 id="_3-1原生方式" tabindex="-1"><a class="header-anchor" href="#_3-1原生方式" aria-hidden="true">#</a> 3.1原⽣⽅式</h2><p>新增</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>   <span class="token annotation punctuation">@Test</span>
    <span class="token doc-comment comment">/**新增*/</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.创建连接对象</span>
        <span class="token class-name">RestHighLevelClient</span> client<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>
                <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;110.40.192.129&quot;</span><span class="token punctuation">,</span><span class="token number">9200</span><span class="token punctuation">,</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.操作</span>
        <span class="token comment">//新增/修改</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1l</span><span class="token punctuation">,</span><span class="token string">&quot;kz&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;测试151515&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">&quot;qyy-test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">source</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.关闭连接</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>   <span class="token annotation punctuation">@Test</span>
    <span class="token doc-comment comment">/**查*/</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.创建连接对象</span>
        <span class="token class-name">RestHighLevelClient</span> client<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>
                <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;110.40.192.129&quot;</span><span class="token punctuation">,</span><span class="token number">9200</span><span class="token punctuation">,</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.操作</span>
        <span class="token class-name">GetResponse</span> documentFields <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GetRequest</span><span class="token punctuation">(</span><span class="token string">&quot;qyy-test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;查询结果:&quot;</span><span class="token operator">+</span>documentFields<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.关闭连接</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删除</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token doc-comment comment">/**删*/</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//1.创建连接对象</span>
    <span class="token class-name">RestHighLevelClient</span> client<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>
            <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;110.40.192.129&quot;</span><span class="token punctuation">,</span><span class="token number">9200</span><span class="token punctuation">,</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//2.操作</span>
    client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DeleteRequest</span><span class="token punctuation">(</span><span class="token string">&quot;qyy-test&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">RequestOptions</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3.关闭连接</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-2使用框架spring-data-elasticsearch-推荐使用" tabindex="-1"><a class="header-anchor" href="#_3-2使用框架spring-data-elasticsearch-推荐使用" aria-hidden="true">#</a> 3.2使⽤框架Spring Data Elasticsearch 推荐使⽤</h2><p>1.导入依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--        1.搜索引擎--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.编写实体类</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">&quot;qyy-test&quot;</span><span class="token punctuation">)</span> <span class="token comment">//设置对应的索引,存储到整个索引下</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span> <span class="token comment">//唯一</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.dao层</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDao</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
                                                  <span class="token comment">// 1.实体类 2.主键类型</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>新增</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">UserDao</span> dao<span class="token punctuation">;</span>
<span class="token doc-comment comment">/**新增*/</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token comment">// </span>
    <span class="token class-name">User</span> kz <span class="token operator">=</span> dao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1l</span><span class="token punctuation">,</span> <span class="token string">&quot;kz&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1110&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;新增成功:&quot;</span><span class="token operator">+</span>kz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新增之后在可视乎进行查看也可通过代码进增删改 <strong>Index Patterns 实现基于Kibana可视化的索引信息</strong><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665759568189-e0078a82-9a0d-4902-883b-649efab40992.png#averageHue=%23ebecd8&amp;clientId=u8bee731a-ad26-4&amp;from=drop&amp;id=u547a9b51&amp;name=1.png&amp;originHeight=811&amp;originWidth=1819&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=129554&amp;status=done&amp;style=none&amp;taskId=ue34135f9-eaf5-416e-bcec-c5bade31be7&amp;title=" alt="1.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665759574949-43845e0a-5320-4a8e-a953-f92b7df26e01.png#averageHue=%23cfd5c9&amp;clientId=u8bee731a-ad26-4&amp;from=drop&amp;id=u18a95d0b&amp;name=2.png&amp;originHeight=726&amp;originWidth=1797&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=131202&amp;status=done&amp;style=none&amp;taskId=udcd09700-9422-47b5-967e-979f82f1ed0&amp;title=" alt="2.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665759582628-02cd22e2-c224-48f1-b227-bbf3fe401079.png#averageHue=%23eee9ca&amp;clientId=u8bee731a-ad26-4&amp;from=drop&amp;id=u96c08699&amp;name=3.png&amp;originHeight=841&amp;originWidth=1662&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=129074&amp;status=done&amp;style=none&amp;taskId=ub7156d3c-0041-4f50-b95b-55445d0471c&amp;title=" alt="3.png"><strong>2.基于Kibana实现可视化操作</strong><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665759644235-67d2822c-a70c-4038-92c3-a8409233e93a.png#averageHue=%23e1cb9f&amp;clientId=u8bee731a-ad26-4&amp;from=drop&amp;id=u8128bc4f&amp;name=4.png&amp;originHeight=810&amp;originWidth=1565&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=58972&amp;status=done&amp;style=none&amp;taskId=ud73e7753-b786-43ab-adbc-cb7ae8b3fab&amp;title=" alt="4.png"></p><h2 id="_3-3操作es实现批处理" tabindex="-1"><a class="header-anchor" href="#_3-3操作es实现批处理" aria-hidden="true">#</a> 3.3操作ES实现批处理</h2><p>线程池，原⽣线程池（7⼤参数） 批量新增：saveAll ⼀般结合线程池，原⽣线程池 实现思路： 1.数据分⽚，要么规定每个线程处理的数量，要么规定最⼤线程 2.计算每个线程处理数据量 3.线程池执⾏任务，调⽤saveAll <strong>集合方式:实现批量添加</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**集合方式:实现批量添加*/</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    dao<span class="token punctuation">.</span><span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> timeMillis <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将时间戳转为秒</span>
    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">toSeconds</span><span class="token punctuation">(</span>timeMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ArrayList</span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10000</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token operator">%</span><span class="token number">100</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            dao<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
          list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> i<span class="token punctuation">,</span><span class="token string">&quot;集合添加&quot;</span><span class="token operator">+</span>i<span class="token punctuation">,</span><span class="token string">&quot;666666&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">long</span> timeMillis1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">toSeconds</span><span class="token punctuation">(</span>timeMillis1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;集合方式:结束：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>线程池添加</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**线程池添加*/</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">long</span> timeMillis <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将时间戳转为秒</span>
    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">toSeconds</span><span class="token punctuation">(</span>timeMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//线程池 7大参数</span>
    <span class="token doc-comment comment">/**
     * 1.核心线程数
     * 2.最大线程数
     * 3.空闲时间
     * 4.空闲时间的单位
     * 5.阻塞队列的容量
     * 6.线程的创建工厂
     * 7.拒绝策略
     * 线程池的工作顺序：
     * 核心--&gt;阻塞队列--&gt;最大线程--&gt;拒绝策略*/</span>
    <span class="token class-name">ThreadPoolExecutor</span> poolExecutor<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>
            <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>CallerRunsPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//计算需要的线程，遍历获取每个线程需要的执行任务</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Goods</span><span class="token punctuation">&gt;</span></span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">long</span> i <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">20001</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">100</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">List</span> arrayList<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//加入线程池，执行</span>
            poolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                dao<span class="token punctuation">.</span><span class="token function">saveAll</span><span class="token punctuation">(</span>arrayList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Goods</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">&quot;线程池添加:&quot;</span><span class="token operator">+</span>i<span class="token punctuation">,</span><span class="token string">&quot;00000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">long</span> timeMillis1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">.</span><span class="token function">toSeconds</span><span class="token punctuation">(</span>timeMillis1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;线程池添加:结束：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询索引中的次数</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">ElasticsearchRestTemplate</span> restTemplate<span class="token punctuation">;</span> <span class="token comment">//Spring Data ES 提供的操作ES的客户端的对象</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//创建查询条件对象</span>
    <span class="token class-name">MatchAllQueryBuilder</span> builder<span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">NativeSearchQuery</span> query<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">NativeSearchQuery</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> c<span class="token operator">=</span>restTemplate<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span><span class="token class-name">Goods</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;qyy-adds&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;数量:&quot;</span><span class="token operator">+</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-4操作es实现复杂查询" tabindex="-1"><a class="header-anchor" href="#_2-4操作es实现复杂查询" aria-hidden="true">#</a> 2.4操作ES实现复杂查询</h2><p>精确查询:TermQueryBuilder 全查询 模糊查询 范围查询:RangeQueryBuilder <strong>TermsQueryBuilder：</strong> 词条查询（Term Query）允许匹配单个未经分析的词条，多词条查询（Terms Query）可以用来匹配多个这样的词条。只要指定字段包含任一我们给定的词条，就可以查询到该文档。<strong>RangeQueryBuilder：</strong> 范围查询，比如数字类型、日期类型等的范围查询：gt gte lt lte</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">SelectAllTest</span> <span class="token punctuation">{</span>
    <span class="token class-name">Logger</span> logger<span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SelectAllTest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">ElasticsearchRestTemplate</span> restTemplate<span class="token punctuation">;</span>
    <span class="token comment">//各种查询 必须使用 ElasticsearchRestTemplate</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//1.创建查询条件对象</span>
        <span class="token class-name">RangeQueryBuilder</span> rangeQueryBuilder<span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;ctitle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//rangeQueryBuilder.gte(10).lte(30.0);</span>
        <span class="token comment">//rangeQueryBuilder.from(1).to(10);</span>
        <span class="token comment">//2.创建查询对象</span>
        <span class="token class-name">NativeSearchQuery</span> nativeSearchQuery<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">NativeSearchQuery</span><span class="token punctuation">(</span>rangeQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置排序的字段和类型</span>
        nativeSearchQuery<span class="token punctuation">.</span><span class="token function">addSort</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置查询的数量</span>
        nativeSearchQuery<span class="token punctuation">.</span><span class="token function">setPageable</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">ofSize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.执行查询</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PcDocument</span><span class="token punctuation">&gt;</span></span> cars<span class="token operator">=</span>restTemplate<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>nativeSearchQuery<span class="token punctuation">,</span><span class="token class-name">PcDocument</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;pc-day&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.遍历结果</span>
        cars<span class="token punctuation">.</span><span class="token function">getSearchHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>sh<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;范围查询：&quot;</span><span class="token operator">+</span>sh<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//精确查询 中文需要配置IK分词器,</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//1.创建查询条件对象</span>
        <span class="token class-name">TermQueryBuilder</span> termQueryBuilder<span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;ctitle&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;我&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.创建查询对象</span>
        <span class="token class-name">NativeSearchQuery</span> nativeSearchQuery<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">NativeSearchQuery</span><span class="token punctuation">(</span>termQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.执行查询</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PcDocument</span><span class="token punctuation">&gt;</span></span> cars<span class="token operator">=</span>restTemplate<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>nativeSearchQuery<span class="token punctuation">,</span><span class="token class-name">PcDocument</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;pc-day&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.遍历结果</span>
        cars<span class="token punctuation">.</span><span class="token function">getSearchHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>sh<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;精确查询：&quot;</span><span class="token operator">+</span>sh<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//通配符查询 *表示任意</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//1.创建查询条件对象</span>
        <span class="token class-name">WildcardQueryBuilder</span> wildcardQueryBuilder<span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">wildcardQuery</span><span class="token punctuation">(</span><span class="token string">&quot;ctitle&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*20*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.创建查询对象</span>
        <span class="token class-name">NativeSearchQuery</span> nativeSearchQuery<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">NativeSearchQuery</span><span class="token punctuation">(</span>wildcardQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.执行查询</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PcDocument</span><span class="token punctuation">&gt;</span></span> cars<span class="token operator">=</span>restTemplate<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>nativeSearchQuery<span class="token punctuation">,</span><span class="token class-name">PcDocument</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;pc-day&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.遍历结果</span>
        cars<span class="token punctuation">.</span><span class="token function">getSearchHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>sh<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;通配符查询：&quot;</span><span class="token operator">+</span>sh<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//全查询</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//1.创建查询条件对象</span>
        <span class="token class-name">MatchAllQueryBuilder</span> matchAllQueryBuilder<span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.创建查询对象</span>
        <span class="token class-name">NativeSearchQuery</span> nativeSearchQuery<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">NativeSearchQuery</span><span class="token punctuation">(</span>matchAllQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置排序</span>
        nativeSearchQuery<span class="token punctuation">.</span><span class="token function">addSort</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置分页查询，每页显示的数量 和对应的页数</span>
        nativeSearchQuery<span class="token punctuation">.</span><span class="token function">setPageable</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">ofSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withPage</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.执行查询</span>
        <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PcDocument</span><span class="token punctuation">&gt;</span></span> cars<span class="token operator">=</span>restTemplate<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>nativeSearchQuery<span class="token punctuation">,</span><span class="token class-name">PcDocument</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;pc-day&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.遍历结果</span>
        cars<span class="token punctuation">.</span><span class="token function">getSearchHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>sh<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;全查询：&quot;</span><span class="token operator">+</span>sh<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//查询数量</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">t8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MatchAllQueryBuilder</span> matchAllQueryBuilder<span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchAllQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">NativeSearchQuery</span> searchQuery<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">NativeSearchQuery</span><span class="token punctuation">(</span>matchAllQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                  <span class="token comment">// native      类.class            document名称</span>
        <span class="token keyword">long</span> ct<span class="token operator">=</span>restTemplate<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>searchQuery<span class="token punctuation">,</span><span class="token class-name">PcDocument</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;pc-day&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;数量：&quot;</span><span class="token operator">+</span>ct<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-5搜索建议查询" tabindex="-1"><a class="header-anchor" href="#_2-5搜索建议查询" aria-hidden="true">#</a> 2.5搜索建议查询</h2><p>1.定义索引格式 <strong>已有的索引中存在数据是无法该变结构得，先创建索引在添加数据，别问为什么。</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>#新增索引
<span class="token constant">PUT</span> pc<span class="token operator">-</span>finaltwo
<span class="token constant">POST</span> pc<span class="token operator">-</span>finaltwo<span class="token operator">/</span>_mapping 
<span class="token punctuation">{</span>
  <span class="token string">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;_class&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;keyword&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ignore_above&quot;</span><span class="token operator">:</span> <span class="token number">256</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;score&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;double&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;keyword&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ignore_above&quot;</span><span class="token operator">:</span> <span class="token number">256</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      # id类型
      <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      # 属性，可多个
      <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;keyword&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;ignore_above&quot;</span><span class="token operator">:</span> <span class="token number">256</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
            # 推荐查询
          <span class="token string">&quot;suggest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;completion&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;simple&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;preserve_separators&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">&quot;preserve_position_increments&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token string">&quot;max_input_length&quot;</span><span class="token operator">:</span> <span class="token number">50</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665826866624-92a4ebd6-18da-46ad-892f-5eab1fae8d92.png#averageHue=%23f0f4f7&amp;clientId=u7683eca5-3056-4&amp;from=paste&amp;height=697&amp;id=u44743709&amp;name=image.png&amp;originHeight=871&amp;originWidth=883&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=84298&amp;status=done&amp;style=none&amp;taskId=ufdcef4b3-6192-4d84-9801-af64846a298&amp;title=&amp;width=706.4" alt="image.png"> 2.编写代码实现</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>   <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">suggest</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.创建搜索建议查询条件</span>
        <span class="token class-name">CompletionSuggestionBuilder</span> completion<span class="token operator">=</span> <span class="token class-name">SuggestBuilders</span><span class="token punctuation">.</span>completionSuggestion
                <span class="token punctuation">(</span><span class="token string">&quot;name.suggest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.设置查询的内容信息</span>
        completion<span class="token punctuation">.</span><span class="token function">prefix</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.创建查询条件</span>
        <span class="token class-name">SuggestBuilder</span> suggestBuilder<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SuggestBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        suggestBuilder<span class="token punctuation">.</span><span class="token function">addSuggestion</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>completion<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>suggestBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.执行查询获取响应                                                              索引</span>
        <span class="token class-name">SearchResponse</span> response<span class="token operator">=</span>restTemplate<span class="token punctuation">.</span><span class="token function">suggest</span><span class="token punctuation">(</span>suggestBuilder<span class="token punctuation">,</span> <span class="token class-name">IndexCoordinates</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;pc-finaltwo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.遍历结果数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> names<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getSuggest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSuggestion</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>o<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                names<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">,</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665827460426-44a97f26-e279-4df1-8182-05b7e89d1508.png#averageHue=%232d2c2c&amp;clientId=u7683eca5-3056-4&amp;from=paste&amp;height=588&amp;id=uf5106d29&amp;name=image.png&amp;originHeight=735&amp;originWidth=1147&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=97958&amp;status=done&amp;style=none&amp;taskId=uc40d6364-5565-4bad-aee9-cec2d686db4&amp;title=&amp;width=917.6" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665827536817-68743f87-5615-4f6c-bad5-e33d272428cd.png#averageHue=%23d2d1d0&amp;clientId=u7683eca5-3056-4&amp;from=paste&amp;height=294&amp;id=u7c1ea4f6&amp;name=image.png&amp;originHeight=367&amp;originWidth=1851&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=90162&amp;status=done&amp;style=none&amp;taskId=ua57a2309-9d2e-42b8-8171-740f0282da2&amp;title=&amp;width=1480.8" alt="image.png"> 那么如何实现多字段搜索呢？<strong>暂未实现</strong><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665828036438-3ecaf089-a9e7-4497-bbff-c845262fbbbe.png#averageHue=%23b3d3e8&amp;clientId=u7683eca5-3056-4&amp;from=paste&amp;height=240&amp;id=u43c1e0c1&amp;name=image.png&amp;originHeight=300&amp;originWidth=1496&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=56429&amp;status=done&amp;style=none&amp;taskId=u6e433c6f-0224-4f8c-af23-cfbbdcd4610&amp;title=&amp;width=1196.8" alt="image.png"> 添加多个字段 <img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665828598109-c4309b09-f369-4729-aba7-eed0c93cc2ae.png#averageHue=%23f2f5f8&amp;clientId=u7683eca5-3056-4&amp;from=paste&amp;height=357&amp;id=u2f8de386&amp;name=image.png&amp;originHeight=446&amp;originWidth=1028&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33949&amp;status=done&amp;style=none&amp;taskId=u71b71632-be7a-4fa3-b9b7-9fedc223454&amp;title=&amp;width=822.4" alt="image.png"></p><h2 id="_2-6高亮显示查询" tabindex="-1"><a class="header-anchor" href="#_2-6高亮显示查询" aria-hidden="true">#</a> 2.6高亮显示查询</h2>`,36),v=n("strong",null,"实现基于Spring Data ES的⾼亮搜索查询",-1),g=n("strong",null,"首先爬取一些数据到es",-1),b={href:"https://www.yuque.com/u32465879/gfttxc/ha4znk",target:"_blank",rel:"noopener noreferrer"},h=a(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PcDocumentDao</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PcDocument</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 查询内容标题查询
     * <span class="token keyword">@param</span> <span class="token parameter">name</span> 标题
     * <span class="token keyword">@return</span> 返回关键字高亮的结果集
     fragmentSize = 500,
     numberOfFragments = 3
     */</span>
    <span class="token annotation punctuation">@Highlight</span><span class="token punctuation">(</span>
            fields <span class="token operator">=</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@HighlightField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            parameters <span class="token operator">=</span> <span class="token annotation punctuation">@HighlightParameters</span><span class="token punctuation">(</span>preTags <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;&lt;span style=&#39;color:red&#39;&gt;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    postTags <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;&lt;/span&gt;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> numberOfFragments <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchHit</span><span class="token punctuation">&lt;</span><span class="token class-name">PcDocument</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>首先第一个注解 @Highlight 是代表当前查询方法需要高亮返回， 通过指定里边的fields (传入注解@HighlightField)来指定要高亮的字段， 上边代码中就代表要高亮 title字段和content字段。如果不指定 parameters 属性，则默认使用 em 标签包裹匹配的关键字。 配合parameters属性(传入注解@HighlightParameters)可以指定高亮方式， preTags 指定匹配关键字之前的标签，postTags 指定匹配关键字之后的标签； 例如上边我指定的分别是 <span style="color:red;"> 和 </span>，那么效果就是 <span style="color:red;"> 搜索后匹配的关键字 </span>。 设置numberOfFragments可以指定返回的片段数，默认是返回全部片段，设置为3返回3个片段，设置为0返回一个片段，包含全部内容，也就是 SearchHit中的highlightFields全部显示。</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665761679047-7d8ef25c-88b3-4d1b-a774-34164f5259a3.png#averageHue=%232f2e2d&amp;clientId=ufc07ae20-66bf-4&amp;from=paste&amp;height=329&amp;id=ub433d532&amp;name=image.png&amp;originHeight=411&amp;originWidth=1365&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=114273&amp;status=done&amp;style=none&amp;taskId=ubdd3276a-a230-4133-b032-061333416cf&amp;title=&amp;width=1092" alt="image.png"> 踩了很久的坑，不知道为什么非要我在实体类有name字段，而且根据name的值进行搜索 2.其余代码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>   <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">queryHigh</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PcDocument</span><span class="token punctuation">&gt;</span></span> documents<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchHit</span><span class="token punctuation">&lt;</span><span class="token class-name">PcDocument</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list<span class="token operator">=</span>documentDao<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            s<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getHighlightField</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            documents<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">,</span>documents<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
controller
   <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;high.do&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">high</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">queryHigh</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.vue3 <strong>axios vue3引入方式</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>npm install <span class="token operator">--</span>save axios vue<span class="token operator">-</span>axios
<span class="token keyword">import</span> <span class="token namespace">axios</span> from <span class="token char">&#39;axios&#39;</span>
<span class="token keyword">import</span> <span class="token class-name">VueAxios</span> from &#39;vue<span class="token operator">-</span>axios&#39;
<span class="token comment">//统一前缀</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> &#39;http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">8081</span>&#39;
<span class="token function">createApp</span><span class="token punctuation">(</span><span class="token class-name">App</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token class-name">VueAxios</span><span class="token punctuation">,</span> axios<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token char">&#39;#app&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>template<span class="token punctuation">&gt;</span></span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;home&quot;</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>h1<span class="token punctuation">&gt;</span></span><span class="token constant">ES</span>高亮搜索查询<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>div<span class="token punctuation">&gt;</span></span><span class="token operator">&lt;</span>input placeholder<span class="token operator">=</span><span class="token string">&quot;请输入搜索的内容&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;msg&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>button <span class="token annotation punctuation">@click</span><span class="token operator">=</span><span class="token string">&quot;search&quot;</span><span class="token operator">&gt;</span>搜索<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>div<span class="token punctuation">&gt;</span></span>
      <span class="token generics"><span class="token punctuation">&lt;</span>ul<span class="token punctuation">&gt;</span></span>
        <span class="token operator">&lt;</span>li v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;b in books&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;b.id&quot;</span><span class="token operator">&gt;</span>
          <span class="token generics"><span class="token punctuation">&lt;</span>div<span class="token punctuation">&gt;</span></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>            <span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;{{b.img}}&quot;</span><span class="token operator">&gt;</span><span class="token operator">--</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;b.img&quot;</span><span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>h4<span class="token punctuation">&gt;</span></span>小说名称：<span class="token punctuation">{</span><span class="token punctuation">{</span>b<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>h4<span class="token punctuation">&gt;</span></span>小说作者：<span class="token punctuation">{</span><span class="token punctuation">{</span>b<span class="token punctuation">.</span>auto<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>h4<span class="token punctuation">&gt;</span></span>章节名称：<span class="token operator">&lt;</span>span v<span class="token operator">-</span>html<span class="token operator">=</span><span class="token string">&quot;b.name&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
            <span class="token generics"><span class="token punctuation">&lt;</span>h4<span class="token punctuation">&gt;</span></span>章节详情：<span class="token operator">&lt;</span>a <span class="token operator">:</span>href<span class="token operator">=</span><span class="token string">&quot;b.imgs&quot;</span><span class="token operator">&gt;</span>点击查看详情<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>script<span class="token punctuation">&gt;</span></span>
export <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> &#39;<span class="token class-name">HomeView</span>&#39;<span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">{</span>
      msg<span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      books<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//请求后端接口</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/book/high.do?name=&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>books<span class="token operator">=</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>books<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://cdn.nlark.com/yuque/0/2022/png/32843666/1665761500562-dab93a57-2c23-400d-932e-4317d0cd6822.png#averageHue=%23fcfcfc&amp;clientId=ufc07ae20-66bf-4&amp;from=paste&amp;height=716&amp;id=u0f369783&amp;name=image.png&amp;originHeight=895&amp;originWidth=644&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=188605&amp;status=done&amp;style=none&amp;taskId=ueb7139c9-fdcd-4e3e-aa9d-497af930318&amp;title=&amp;width=515.2" alt="image.png"></p><h1 id="三、elasticsearch总结" tabindex="-1"><a class="header-anchor" href="#三、elasticsearch总结" aria-hidden="true">#</a> 三、ElasticSearch总结</h1><blockquote><p>1.雪花算法</p></blockquote><h2 id="_3-1-elasticsearch存储原理" tabindex="-1"><a class="header-anchor" href="#_3-1-elasticsearch存储原理" aria-hidden="true">#</a> 3.1 ElasticSearch存储原理</h2><h2 id="_3-2-elasticsearch倒排索引" tabindex="-1"><a class="header-anchor" href="#_3-2-elasticsearch倒排索引" aria-hidden="true">#</a> 3.2 ElasticSearch倒排索引</h2><h2 id="_3-3-elasticsearch应用场景" tabindex="-1"><a class="header-anchor" href="#_3-3-elasticsearch应用场景" aria-hidden="true">#</a> 3.3 ElasticSearch应⽤场景</h2>`,13);function f(y,q){const t=o("ExternalLinkIcon");return c(),l("div",null,[u,n("p",null,[s("2.访问测试 云服务器：开放安全组：9200 "),n("a",r,[s("http://路径:9200/"),p(t)])]),k,n("p",null,[s("访问测试 "),n("a",d,[s("http://110.40.192.129:5601/app/kibana"),p(t)])]),m,n("p",null,[v,g,s(" 详细请看："),n("a",b,[s("WebMagic"),p(t)]),s(" 1.设置高亮查询的方法")]),h])}const S=e(i,[["render",f],["__file","ElasticSearch.html.vue"]]);export{S as default};
